<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Геокодер улиц Атырау — 2GIS API</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, sans-serif; background: #1a1a2e; color: #e0e0e0; padding: 20px; }
h1 { color: #f0c040; margin-bottom: 10px; font-size: 1.4em; }
p.hint { color: #aaa; margin-bottom: 20px; font-size: 0.9em; }
.row { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }
label { min-width: 90px; }
input { padding: 8px 12px; border: 1px solid #444; border-radius: 6px; background: #2a2a3e; color: #fff; flex: 1; font-size: 14px; }
button { padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; }
#startBtn { background: #f0c040; color: #1a1a2e; }
#startBtn:disabled { opacity: 0.5; cursor: not-allowed; }
#downloadBtn { background: #27ae60; color: #fff; display: none; }
#log { background: #111; border-radius: 8px; padding: 15px; font-family: monospace; font-size: 12px; height: 400px; overflow-y: auto; white-space: pre-wrap; margin-top: 10px; }
.ok { color: #2ecc71; }
.fail { color: #e74c3c; }
.info { color: #3498db; }
#progress { margin: 10px 0; }
#progressBar { width: 100%; height: 20px; background: #333; border-radius: 10px; overflow: hidden; }
#progressFill { height: 100%; background: linear-gradient(90deg, #f0c040, #27ae60); width: 0%; transition: width 0.3s; }
#stats { color: #aaa; font-size: 13px; margin-top: 5px; }
</style>
</head>
<body>

<h1>Геокодер улиц Атырау</h1>
<p class="hint">Этот инструмент использует 2GIS Geocoder API для получения точных координат улиц из crime-raw.txt</p>

<div class="row">
    <label>API ключ:</label>
    <input type="text" id="apiKey" placeholder="Вставьте ваш 2GIS API ключ" />
</div>

<div class="row">
    <button id="startBtn" onclick="startGeocoding()">Запустить геокодирование</button>
    <button id="downloadBtn" onclick="downloadResult()">Скачать crime-points.js</button>
</div>

<div id="progress">
    <div id="progressBar"><div id="progressFill"></div></div>
    <div id="stats"></div>
</div>

<div id="log"></div>

<script>
// ═══════════════════════════════════════════════════
//  All unique street names from crime-raw.txt
// ═══════════════════════════════════════════════════
const NAMED_STREETS = ["ЖУБАН МОЛДАГАЛИЕВ","АТЫРАУ-ДОССОР","ЗАРОСЛЫЙ","НҰРСАЯ","УӘЛИ ЖАЙЫҚОВ","АЗАТТЫҚ","ЖОЛДАСҚАЛИ ДОСМҰХАМБЕТОВ","ГРУШЕВАЯ","НАБЕРЕЖНАЯ","АЛМАГҮЛ","КЛУБНИЧНЫЙ","ОРЫНГАЛИ СМАГУЛОВ","АЙЖАРҚЫН ӘЛІШЕВА","ӨРЕКЕШЕВ СӘРСЕН","АБАЙ","АҒИДОЛЛА НҰҒЫМАНОВ","ПРИДОРОЖНАЯ","МҰСА БАЙМҰХАНОВ","АРОН АЮПОВ","САДОВАЯ","ВОКЗАЛ МАҢЫ-3А","РАБОЧАЯ","ПРИУРАЛЬНАЯ","БЕЙБАРЫС","ПРИВОКЗАЛЬНЫЙ","АВАНГАРД-3","ӨРКЕН","ЗОНА ОТДЫХА","СӘЛІМГЕРЕЙ СӘБЕТОВ","СТРОЙКОНТОР","ВОКЗАЛ МАҢЫ - 5","ЮРИЙ ГАГАРИН","ИСАТАЙ","ШӘЛИ ЕРКЕШОВ","ОРКЕН","АКАДЕМИК БИНЕШ ЖАРБОСЫНОВ","МАХАМБЕТ ӨТЕМІСҰЛЫ","АҚ ШАҒАЛА","КРЫЖОВНИКОВА","АВАНГАРД-2","АЗАТТЫК","МОЛШЫЛЫҚ","ҒАРЫШКЕР","ТУПИКОВАЯ","АВАНГАРД -2","АГАЙЫНДЫ ЖОЛАМАН МЕН ХАМЗА КАШАУОВТАР","АЛМАТЫ","СӘТҚҰЛ БЕКЖАНОВ","ҚҰРЫЛЫСШЫЛАР","ҚҰРМАНҒАЗЫ","ГЕОРГИЙ КАНЦЕВ","ҒАББАС БЕРГАЛИЕВ","СОЛТҮСТІК","КӨКТЕМ","Ә.ӨМІРЗАҚОВА","ҚАРШЫҒА АХМЕДЬЯРОВ","ЖҰМЕКЕН НӘЖІМЕДЕНОВ","МУХАН НҰРМАНОВ","АТЫРАУ ДОССОР","ДМИТРИЙ МЕНДЕЛЕЕВ","ЖАСТАР","БЕЙІМБЕТ МАЙЛИН","КУЛЯШ БАЙСЕИТОВОЙ","ИБАТОЛЛА ШЕКЕНОВ","БОЛАШАҚ","АЛМАГҮЛ МӨЛТЕК АУДАНЫ","САРЫАРҚА","ҚАНЫШ СӘТБАЕВ","ЖИЕМБЕТ","НҰРҒИСА ТЛЕНДИЕВ","СЫРЫМ ДАТОВ","ОРТАЛЫҚ","ҒИНАЯТ ӘБДІРАХМАНОВ","МҰНАЙШЫ","БЕРЕКЕ","АТЫРАУ","АНУАРБЕК АККУЛОВ","С.БЕЙБАРЫС","АБАЙ ҚҰНАНБАЕВ","АМӨЗ АУМАҒЫНДАҒЫ ӨНДІРІС АЙМАҒЫ","АДМИРАЛ ЛЕВ ВЛАДИМИРСКИЙ","ҚАДІРӘЛІ БАЛМАНОВ","ЖҰЛДЫЗ-3","ФЕРМА","ХИМИК АТЫРАУ","ДОСТЫҚ","ӘЖІҒАЛИ ЖАҚСЫБАЕВ","ТАМПОНАЖНИК","ЖИЛОЙ КОМПЛЕКС ГАУХАРТАС","ӘУБЕКЕРОВ АСЫЛБЕК","АВАНГАРД","СТУДЕНТТЕР","ҚАЙЫРҒАЛИ СМАҒҰЛОВ","ӘБДІРЕШ ДӘУЛЕТОВ","ШАЙХЫ ӘБІШЕВ","КЕҢӨЗЕК А.О","ЖАЗЫКБАЕВ","МИРАС","МАРАТ ТЕМІРХАНОВ"];

const MICRODISTRICTS = ["14","10","11","7","3","2","18","24","8","20","16","21","5","27","13","45","23","290","30","4"];

// ═══════════════════════════════════════════════════
//  Crime records from crime-raw.txt
// ═══════════════════════════════════════════════════
const CRIME_RAW = `ст.288 ч.1\tЖУБАН МОЛДАГАЛИЕВ\t29А
ст.288 ч.1\tАтырау-Доссор\t123
ст.288 ч.1\tЗАРОСЛЫЙ\t1
ст.108-1 ч.2\tНҰРСАЯ\t109А
ст.433 ч.3\tУӘЛІ ЖАЙЫҚОВ\t13/1
ст.107 ч.1\tАЗАТТЫҚ\t2
ст.108-1 ч.2\tЖОЛДАСҚАЛИ ДОСМҰХАМБЕТОВ\t17
ст.433 ч.2\t\t
ст.273\tГРУШЕВАЯ\t121
ст.345 ч.3\t14\t33
ст.188 ч.3\tНАБЕРЕЖНАЯ\t16
ст.188 ч.1\tАЛМАГҮЛ\t5
ст.262 ч.1\t10\t1
ст.262 ч.2\t10\t1
ст.299 ч.1\tКЛУБНИЧНЫЙ\t5
ст.423 ч.1\tОрынгали Смагулов\t37
ст.188 ч.2\tАЙЖАРҚЫН ӘЛІШЕВА\t13/1
ст.188 ч.2\tӨРЕКЕШЕВ СӘРСЕН\t1
ст.287 ч.2\tАБАЙ\t10
ст.287 ч.2\t№11\t4
ст.287 ч.2\t№ 7\t5
ст.105 ч.1\tАБАЙ\t16А
ст.345 ч.3\tАБАЙ\t
ст.296 ч.2\tКЛУБНИЧНЫЙ\t11
ст.420 ч.1\tАҒИДОЛЛА НҰҒЫМАНОВ\t10
ст.188 ч.1\tПРИДОРОЖНАЯ\t39
ст.293 ч.2\t7\t15
ст.107 ч.2\tМҰСА БАЙМҰХАНОВ\t66
ст.188 ч.1\tАрон Аюпов\t
ст.188 ч.1\tКЛУБНИЧНЫЙ\t6
ст.345 ч.3\tСАДОВАЯ\t117
ст.188 ч.2\tГРУШЕВАЯ\t82
ст.296 ч.2\tНАБЕРЕЖНАЯ\t62
ст.188 ч.1\tСАДОВАЯ\t41
ст.345 ч.3\tАВАНГАРД-3\t16
ст.188 ч.1\tАВАНГАРД-3\t16
ст.415 ч.1\tНАБЕРЕЖНАЯ\t61
ст.296 ч.2\tПРИДОРОЖНАЯ\t61
ст.188 ч.1\tКРЫЖОВНИКОВА\t30
ст.345 ч.3\t14\t2
ст.188 ч.1\tГРУШЕВАЯ\t32
ст.188 ч.2\tПРИДОРОЖНАЯ\t3
ст.188 ч.2\tСАДОВАЯ\t49
ст.188 ч.1\tАҒИДОЛЛА НҰҒЫМАНОВ\t10
ст.188 ч.2\tАЛМАГҮЛ\t32
ст.188 ч.3\tНАБЕРЕЖНАЯ\t29
ст.296 ч.2\tКЛУБНИЧНЫЙ\t43
ст.188 ч.1\tАВАНГАРД-3\t4
ст.345 ч.3\t14\t21
ст.188 ч.2\tТУПИКОВАЯ\t25
ст.345 ч.3\tСАДОВАЯ\t83
ст.273\tНАБЕРЕЖНАЯ\t62
ст.188 ч.1\tГРУШЕВАЯ\t65
ст.296 ч.2\t10\t21
ст.188 ч.2\tМҰСА БАЙМҰХАНОВ\t34
ст.188 ч.1\tНАБЕРЕЖНАЯ\t53
ст.188 ч.1\tГРУШЕВАЯ\t65
ст.188 ч.2\tПРИДОРОЖНАЯ\t3
ст.188 ч.3\tКЛУБНИЧНЫЙ\t43
ст.188 ч.1\tСАДОВАЯ\t38
ст.287 ч.2\tАБАЙ\t10
ст.188 ч.1\tНАБЕРЕЖНАЯ\t62
ст.345 ч.3\tГРУШЕВАЯ\t53
ст.345 ч.3\t10\t14
ст.345 ч.3\tГРУШЕВАЯ\t32
ст.188 ч.2\tПРИДОРОЖНАЯ\t42
ст.345 ч.3\tПРИДОРОЖНАЯ\t42
ст.345 ч.3\tПРИДОРОЖНАЯ\t42
ст.188 ч.2\tНАБЕРЕЖНАЯ\t34
ст.188 ч.1\tКЛУБНИЧНЫЙ\t57
ст.345 ч.3\tНАБЕРЕЖНАЯ\t62
ст.345 ч.3\tНАБЕРЕЖНАЯ\t62
ст.188 ч.1\tГРУШЕВАЯ\t28
ст.188 ч.1\tКРЫЖОВНИКОВА\t27
ст.188 ч.1\tНАБЕРЕЖНАЯ\t53
ст.296 ч.2\tПРИДОРОЖНАЯ\t42
ст.345 ч.3\tГРУШЕВАЯ\t81
ст.345 ч.3\t№24\t4
ст.188 ч.3\tНАБЕРЕЖНАЯ\t35
ст.345 ч.3\tКЛУБНИЧНЫЙ\t6
ст.188 ч.1\tГРУШЕВАЯ\t41
ст.345 ч.3\tКЛУБНИЧНЫЙ\t43
ст.188 ч.1\tАВАНГАРД-3\t4
ст.345 ч.3\tКРЫЖОВНИКОВА\t70
ст.188 ч.2\t№24\t37
ст.296 ч.2\tАҒИДОЛЛА НҰҒЫМАНОВ\t12
ст.188 ч.3\tАБАЙ\t10А
ст.188 ч.1\tТУПИКОВАЯ\t29
ст.345 ч.3\tБЕЙБАРЫС\t
ст.188 ч.1\tГРУШЕВАЯ\t3
ст.188 ч.1\tПРИДОРОЖНАЯ\t27
ст.296 ч.2\tКРЫЖОВНИКОВА\t70
ст.188 ч.1\tНАБЕРЕЖНАЯ\t31
ст.188 ч.1\tКЛУБНИЧНЫЙ\t17
ст.188 ч.1\tПРИДОРОЖНАЯ\t69
ст.188 ч.1\tГРУШЕВАЯ\t112
ст.188 ч.1\tСАДОВАЯ\t65
ст.420 ч.1\tСАДОВАЯ\t65
ст.188 ч.1\tМҰСА БАЙМҰХАНОВ\t41
ст.188 ч.1\tНАБЕРЕЖНАЯ\t35
ст.345 ч.3\tНАБЕРЕЖНАЯ\t62
ст.416 ч.1\tСАДОВАЯ\t38
ст.415 ч.1\t10\t14
ст.188 ч.1\tСАДОВАЯ\t135
ст.272 ч.1\tСАДОВАЯ\t117
ст.188 ч.1\tСАДОВАЯ\t86
ст.188 ч.1\t10\t9
ст.188 ч.2\tКРЫЖОВНИКОВА\t27
ст.188 ч.2\tБЕЙБАРЫС\t8
ст.296 ч.2\tСАДОВАЯ\t62
ст.188 ч.1\tАБАЙ\t19
ст.188 ч.1\tНАБЕРЕЖНАЯ\t36
ст.188 ч.1\tЗОНА ОТДЫХА\t61
ст.188 ч.1\tНАБЕРЕЖНАЯ\t16
ст.345 ч.3\tГРУШЕВАЯ\t79
ст.188 ч.2\tПРИДОРОЖНАЯ\t27
ст.345 ч.3\tСАДОВАЯ\t38
ст.345 ч.3\tСАДОВАЯ\t38
ст.188 ч.1\tАБАЙ\t10
ст.188 ч.1\tСАДОВАЯ\t38
ст.188 ч.1\tПРИДОРОЖНАЯ\t24
ст.188 ч.1\tЗОНА ОТДЫХА\t92
ст.188 ч.2\tКЛУБНИЧНЫЙ\t43
ст.188 ч.2\tСАДОВАЯ\t24
ст.188 ч.2\tКРЫЖОВНИКОВА\t27
ст.345 ч.3\tГРУШЕВАЯ\t86
ст.188 ч.2\t14\t33
ст.188 ч.2\tАБАЙ\t10
ст.188 ч.1\tСАДОВАЯ\t65
ст.188 ч.1\tАВАНГАРД-3\t8
ст.188 ч.1\tТУПИКОВАЯ\t30
ст.188 ч.1\tКРЫЖОВНИКОВА\t27
ст.188 ч.2\tСАДОВАЯ\t35
ст.296 ч.2\tПРИДОРОЖНАЯ\t24
ст.345 ч.3\tСАДОВАЯ\t101
ст.192 ч.2\tАВАНГАРД-3\t16
ст.188 ч.1\tЗОНА ОТДЫХА\t69А
ст.345 ч.3\tКЛУБНИЧНЫЙ\t5
ст.188 ч.2\tНАБЕРЕЖНАЯ\t53
ст.188 ч.2\tГРУШЕВАЯ\t53
ст.188 ч.1\tЗОНА ОТДЫХА\t38
ст.188 ч.2\tКЛУБНИЧНЫЙ\t6
ст.188 ч.1\tСАДОВАЯ\t35
ст.188 ч.1\tГРУШЕВАЯ\t28
ст.296 ч.2\t10\t21
ст.188 ч.1\tГРУШЕВАЯ\t57
ст.188 ч.2\tЗОНА ОТДЫХА\t43
ст.188 ч.1\tСАДОВАЯ\t35
ст.345 ч.3\t14\t14
ст.296 ч.2\t14\t2
ст.188 ч.2\tАЛМАГҮЛ\t5
ст.188 ч.2\tПРИДОРОЖНАЯ\t69
ст.345 ч.3\tБЕЙБАРЫС\t3
ст.188 ч.2\tТУПИКОВАЯ\t29
ст.345 ч.3\tАВАНГАРД-3\t
ст.345 ч.3\t14\t2
ст.188 ч.3\t14\t25
ст.188 ч.1\tКЛУБНИЧНЫЙ\t43
ст.188 ч.1\tНАБЕРЕЖНАЯ\t13
ст.188 ч.2\tАБАЙ\t
ст.188 ч.1\tБЕЙБАРЫС\t2
ст.345 ч.3\t14\t21
ст.345 ч.3\t11\t12
ст.345 ч.3\t№24\t20
ст.287 ч.2\t11\t12
ст.188 ч.1\tАЗАТТЫҚ\t2
ст.188 ч.1\tАҒИДОЛЛА НҰҒЫМАНОВ\t2
ст.433 ч.3\tВОКЗАЛ МАҢЫ-3А\t114
ст.345 ч.3\tПРИДОРОЖНАЯ\t24
ст.188 ч.2\tБЕЙБАРЫС\t4
ст.345 ч.3\t№24\t47
ст.188 ч.2\tМАХАМБЕТ ӨТЕМІСҰЛЫ\t9
ст.188 ч.1\tМАХАМБЕТ ӨТЕМІСҰЛЫ\t9
ст.188 ч.1\tАҒИДОЛЛА НҰҒЫМАНОВ\t8
ст.345 ч.3\t10\t21
ст.345 ч.3\tАЛМАГҮЛ МӨЛТЕК АУДАНЫ\t
ст.188 ч.2\tАЛМАГҮЛ\t
ст.345 ч.3\t№24\t48
ст.188 ч.1\tАВАНГАРД-2\t3
ст.188 ч.2\tАВАНГАРД-2\t3
ст.345 ч.3\tНАБЕРЕЖНАЯ\t16
ст.420 ч.1\tЖУБАН МОЛДАГАЛИЕВ\t
ст.188 ч.2\t10\t23
ст.299 ч.1\tВОКЗАЛ МАҢЫ-3А\t114
ст.188 ч.1\tВОКЗАЛ МАҢЫ-3А\t90
ст.345 ч.3\tАБАЙ\t10
ст.188 ч.1\tАРОН АЮПОВ\t11/1
ст.188 ч.1\tАЛМАГҮЛ\t17
ст.188 ч.2\tБЕЙБАРЫС\t3
ст.188 ч.2\t№8\t22
ст.188 ч.2\t18\t3
ст.188 ч.2\tЩАДОВАЯ\t38
ст.188 ч.3\tАҒИДОЛЛА НҰҒЫМАНОВ\t12
ст.188 ч.2\tГРУШЕВАЯ\t65
ст.188 ч.1\tМАХАМБЕТ ӨТЕМІСҰЛЫ\t7
ст.188 ч.2\t№24\t47
ст.345 ч.3\tНАБЕРЕЖНАЯ\t62
ст.188 ч.2\tБЕЙБАРЫС\t10
ст.345 ч.3\tНАБЕРЕЖНАЯ\t16
ст.188 ч.1\tКЛУБНИЧНЫЙ\t57
ст.188 ч.2\tМҰСА БАЙМҰХАНОВ\t7
ст.188 ч.1\tСАДОВАЯ\t88
ст.296 ч.2\t№24\t38
ст.188 ч.2\tВОКЗАЛ МАҢЫ-3А\t93
ст.188 ч.2\t№24\t38
ст.188 ч.2\t№24\t9
ст.188 ч.1\tНАБЕРЕЖНАЯ\t35
ст.188 ч.1\tПРИУРАЛЬНАЯ\t37
ст.188 ч.1\tПРИУРАЛЬНАЯ\t37
ст.188 ч.3\t№24\t20
ст.296 ч.2\t7\t28
ст.273\tАВАНГАРД-3\t
ст.345 ч.3\t14\t46
ст.188 ч.2\t№24\t47
ст.188 ч.1\tАВАНГАРД-2\t12
ст.345 ч.3\t7\t15
ст.188 ч.2\t7\t28
ст.188 ч.2\t11\t12
ст.345 ч.3\t10\t14
ст.188 ч.2\t10\t21
ст.296 ч.2\tВОКЗАЛ МАҢЫ-3А\t
ст.188 ч.2\t10\t21
ст.345 ч.3\t11\t5
ст.188 ч.1\tМУХАН НҰРМАНОВ\t19
ст.293 ч.2\tМУХАН НҰРМАНОВ\t19
ст.345 ч.3\t7\t34
ст.188 ч.2\tНАБЕРЕЖНАЯ\t35
ст.188 ч.2\tБЕЙБАРЫС\t4
ст.345 ч.3\tҚАНЫШ СӘТБАЕВ\t5/1
ст.188 ч.3\tНАБЕРЕЖНАЯ\t29
ст.188 ч.2\tАВАНГАРД -2\t12
ст.188 ч.1\tПРИДОРОЖНАЯ\t31
ст.345 ч.3\t№24\t27
ст.188 ч.2\tНҰРСАЯ\t22
ст.188 ч.2\tНҰРСАЯ\t63
ст.188 ч.2\tСАДОВАЯ\t24
ст.345 ч.3\tПРИВОКЗАЛЬНЫЙ\t10/1
ст.188 ч.2\tПРИВОКЗАЛЬНЫЙ\t10/1
ст.188 ч.2\tВОКЗАЛ МАҢЫ - 5\t18
ст.188 ч.2\tВОКЗАЛ МАҢЫ - 5\t18
ст.188 ч.2\tКЛУБНИЧНЫЙ\t5
ст.188 ч.2\tМУХАН НҰРМАНОВ\t7
ст.287 ч.2\t№24\t8
ст.188 ч.3\tПРИДОРОЖНАЯ\t24
ст.345 ч.3\t№16\t14
ст.188 ч.2\tНАБЕРЕЖНАЯ\t13
ст.188 ч.1\t10\t1
ст.188 ч.2\tАВАНГАРД-3\t
ст.345 ч.3\t14\t25
ст.188 ч.1\tКЛУБНИЧНЫЙ\t43
ст.188 ч.1\tАЛМАГҮЛ\t17
ст.188 ч.2\tСАДОВАЯ\t65
ст.188 ч.2\tАЛМАГҮЛ\t17
ст.188 ч.2\t14\t26
ст.188 ч.2\t№24\t47
ст.188 ч.1\tАТЫРАУ-ДОССОР\t99
ст.188 ч.1\tАТЫРАУ-ДОССОР\t51
ст.345 ч.3\t14\t2
ст.296 ч.2\tАВАНГАРД-3\t
ст.188 ч.2\tАВАНГАРД-3\t
ст.188 ч.2\tАВАНГАРД-3\t
ст.345 ч.3\tКЛУБНИЧНЫЙ\t43
ст.188 ч.2\tНАБЕРЕЖНАЯ\t16
ст.345 ч.3\tАҒИДОЛЛА НҰҒЫМАНОВ\t10
ст.296 ч.2\tКЛУБНИЧНЫЙ\t43
ст.345 ч.3\tАҒИДОЛЛА НҰҒЫМАНОВ\t12
ст.345 ч.3\t№8\t12
ст.188 ч.2\t№24\t22
ст.188 ч.2\tАҒИДОЛЛА НҰҒЫМАНОВ\t2
ст.345 ч.3\t№16\t31
ст.188 ч.2\t№8\t22
ст.345 ч.3\t№3\t30
ст.345 ч.3\t2\t2
ст.345 ч.3\t2\t12
ст.345 ч.3\t2\t12
ст.345 ч.3\t№3\t30
ст.188 ч.2\tГЕОРГИЙ КАНЦЕВ\t6
ст.345 ч.3\tГЕОРГИЙ КАНЦЕВ\t6
ст.188 ч.2\t№3\t30
ст.296 ч.2\tОРЫНГАЛИ СМАГУЛОВ\t5
ст.188 ч.2\tАЗАТТЫК\t1
ст.188 ч.2\tҚАНЫШ СӘТБАЕВ\t5/1
ст.345 ч.3\tНАБЕРЕЖНАЯ\t31
ст.188 ч.2\t№20\t28
ст.188 ч.2\t№8\t22
ст.188 ч.2\tҚАНЫШ СӘТБАЕВ\t17
ст.188 ч.2\tКУЛЯШ БАЙСЕИТОВОЙ\t10
ст.188 ч.2\tҚАНЫШ СӘТБАЕВ\t14
ст.188 ч.2\tНҰРҒИСА ТЛЕНДИЕВ\t9/1
ст.188 ч.2\tСЫРЫМ ДАТОВ\t10
ст.345 ч.3\t№ 4\t23
ст.188 ч.2\tНҰРҒИСА ТЛЕНДИЕВ\t9
ст.188 ч.2\tСЫРЫМ ДАТОВ\t10
ст.188 ч.2\tОРЫНГАЛИ СМАГУЛОВ\t15
ст.188 ч.2\t№8\t22
ст.188 ч.2\tТУПИКОВАЯ\t7
ст.188 ч.1\tАТЫРАУ-ДОССОР\t41
ст.188 ч.2\tКУЛЯШ БАЙСЕИТОВОЙ\t4
ст.345 ч.3\t№2\t46
ст.188 ч.2\tОРЫНГАЛИ СМАГУЛОВ\t5
ст.188 ч.2\tАЛМАТЫ\t1
ст.345 ч.3\t№8\t22
ст.345 ч.3\t7\t28
ст.345 ч.3\t№11\t4
ст.345 ч.3\tНАБЕРЕЖНАЯ\t35
ст.345 ч.3\t10\t21
ст.345 ч.3\t3\t23
ст.188 ч.2\t3\t31
ст.188 ч.2\tГРУШЕВАЯ\t79
ст.345 ч.3\t№16\t31
ст.188 ч.2\tАТЫРАУ ДОССОР\t41
ст.188 ч.2\tНАБЕРЕЖНАЯ\t36
ст.188 ч.2\t10\t10
ст.345 ч.3\t10\t10
ст.188 ч.2\t№20\t21
ст.188 ч.1\tСАДОВАЯ\t88
ст.188 ч.1\tАЛМАГҮЛ МӨЛТЕК АУДАНЫ\t
ст.296 ч.2\tАВАНГАРД-3\t
ст.188 ч.1\tАВАНГАРД-3\t
ст.188 ч.2\tОРЫНГАЛИ СМАГУЛОВ\t37
ст.188 ч.2\tГРУШЕВАЯ\t28
ст.345 ч.3\tКРЫЖОВНИКОВА\t87
ст.188 ч.1\tМАХАМБЕТ ӨТЕМІСҰЛЫ\t11
ст.345 ч.3\tОРЫНГАЛИ СМАГУЛОВ\t37
ст.188 ч.2\tМҰСА БАЙМҰХАНОВ\t34
ст.345 ч.3\tОРЫНГАЛИ СМАГУЛОВ\t37
ст.345 ч.3\tАБАЙ\t10
ст.345 ч.3\tГРУШЕВАЯ\t65
ст.188 ч.3\tКРЫЖОВНИКОВА\t30
ст.188 ч.1\tАБАЙ\t10
ст.188 ч.2\tАБАЙ\t14
ст.188 ч.3\tКЛУБНИЧНЫЙ\t43
ст.345 ч.3\t№21\t1
ст.345 ч.3\t№21\t4
ст.188 ч.1\tНАБЕРЕЖНАЯ\t35
ст.188 ч.1\t10\t21
ст.188 ч.1\t10\t14
ст.188 ч.2\t16\t4
ст.188 ч.1\t16\t4
ст.188 ч.1\tАҒИДОЛЛА НҰҒЫМАНОВ\t2
ст.296 ч.2\tГРУШЕВАЯ\t65
ст.188 ч.2\t14\t33
ст.188 ч.2\tШӘЛІ ЕРКЕШОВ\t7
ст.188 ч.2\tОРКЕН\t1
ст.188 ч.2\tАКАДЕМИК БИНЕШ ЖАРБОСЫНОВ\t
ст.188 ч.1\tАҚ ШАҒАЛА\t8А
ст.188 ч.2\t14\t33
ст.296 ч.2\t14\t2
ст.188 ч.1\t14\t46
ст.188 ч.2\t20\t
ст.345 ч.3\t16\t4
ст.188 ч.2\tМОЛШЫЛЫҚ\t10
ст.188 ч.2\tҒАРЫШКЕР\t2
ст.188 ч.2\tАВАНГАРД -2\t12
ст.188 ч.2\tАГАЙЫНДЫ ЖОЛАМАН МЕН ХАМЗА КАШАУОВТАР\t5
ст.345 ч.3\tАЛМАТЫ\t
ст.188 ч.2\tСӘТҚҰЛ БЕКЖАНОВ\t15
ст.188 ч.1\tҚҰРЫЛЫССЫЛАР\t19
ст.345 ч.3\tҚҰРМАНҒАЗЫ\t87
ст.188 ч.1\tҒАББАС БЕРГАЛИЕВ\t
ст.188 ч.2\tСОЛТҮСТІК\t14
ст.296 ч.2\tҚҰРМАНҒАЗЫ\t18
ст.188 ч.2\tКӨКТЕМ\t
ст.188 ч.3\t8\t5
ст.345 ч.3\tҚҰРМАНҒАЗЫ\t18
ст.345 ч.3\tКЛУБНИЧНЫЙ\t43
ст.188 ч.2\tҚАНЫШ СӘТБАЕВ\t5/1
ст.345 ч.3\tОРЫНГАЛИ СМАГУЛОВ\t5
ст.345 ч.3\tНАБЕРЕЖНАЯ\t29
ст.188 ч.2\tӘ.ӨМІРЗАҚОВА\t14
ст.188 ч.2\tМАХАМБЕТ ӨТЕМІСҰЛЫ\t
ст.188 ч.2\tҚАРШЫҒА АХМЕДЬЯРОВ\t2
ст.188 ч.2\tЖҰМЕКЕН НӘЖІМЕДЕНОВ\t12
ст.188 ч.2\tМУХАН НҰРМАНОВ\t19
ст.188 ч.2\tҚҰРМАНҒАЗЫ\t18
ст.188 ч.2\tДМИТРИЙ МЕНДЕЛЕЕВ\t
ст.188 ч.2\tАЗАТТЫК\t
ст.188 ч.2\tЖАСТАР\t36
ст.188 ч.2\tГРУШЕВАЯ\t121
ст.188 ч.2\tБЕЙІМБЕТ МАЙЛИН\t12
ст.188 ч.2\tАВАНГАРД-2\t3
ст.188 ч.1\tКУЛЯШ БАЙСЕИТОВОЙ\t4
ст.188 ч.2\tИБАТОЛЛА ШЕКЕНОВ\t
ст.345 ч.3\t16\t7
ст.345 ч.3\t№8\t22
ст.345 ч.3\tБОЛАШАҚ\t11
ст.188 ч.2\tСАРЫАРҚА\t
ст.188 ч.2\tЖИЕМБЕТ\t
ст.345 ч.3\t№45\t4
ст.345 ч.3\tОРТАЛЫҚ\t
ст.188 ч.2\tМҰНАЙШЫ\t7
ст.188 ч.2\tГИНАЯТ ӘБДІРАХМАНОВ\t
ст.188 ч.2\tБЕРЕКЕ\t14А
ст.188 ч.2\tАТЫРАУ\t39
ст.188 ч.2\tАНУАРБЕК АККУЛОВ\t14
ст.345 ч.3\tС.БЕЙБАРЫС\t
ст.188 ч.2\tАБАЙ ҚҰНАНБАЕВ\t10
ст.345 ч.3\tАМӨЗ АУМАҒЫНДАҒЫ ӨНДІРІС АЙМАҒЫ\t
ст.188 ч.2\tАДМИРАЛ ЛЕВ ВЛАДИМИРСКИЙ\t7
ст.188 ч.2\tҚАДІРӘЛІ БАЛМАНОВ\t17
ст.345 ч.3\t16\t7
ст.345 ч.3\t№23\t37
ст.345 ч.3\tЖҰЛДЫЗ-3\t5
ст.345 ч.3\tФЕРМА\t7
ст.345 ч.3\t№290\t29
ст.188 ч.2\tӘЖІҒАЛИ ЖАҚСЫБАЕВ\t7
ст.188 ч.2\tТАМПОНАЖНИК\t4
ст.188 ч.2\tЖИЛОЙ КОМПЛЕКС ГАУХАРТАС\t1
ст.188 ч.2\tӘУБЕКЕРОВ АСЫЛБЕК\t14А
ст.188 ч.2\tАВАНГАРД\t10
ст.188 ч.2\tСТУДЕНТТЕР\t26
ст.188 ч.2\tҚАЙЫРҒАЛИ СМАҒҰЛОВ\t6
ст.188 ч.2\tӘБДІРЕШ ДӘУЛЕТОВ\t10
ст.188 ч.2\tШАЙХЫ ӘБІШЕВ\t
ст.188 ч.2\tКЕҢӨЗЕК А.О\t
ст.188 ч.2\tЖАЗЫКБАЕВ\t8
ст.188 ч.2\t№30\t15
ст.188 ч.2\t5\t5
ст.188 ч.2\t5\t19
ст.188 ч.2\tХИМИК АТЫРАУ\t15
ст.188 ч.2\tДОСТЫҚ\t3
ст.188 ч.2\tГИНАЯТ ӘБДІРАХМАНОВ\t
ст.188 ч.2\tМИРАС\t12
ст.188 ч.2\tМАРАТ ТЕМІРХАНОВ\t8
ст.345 ч.3\tАТЫРАУ\t
ст.345 ч.3\tДОСТЫҚ\t34
ст.345 ч.3\tМАРАТ ТЕМІРХАНОВ\t8
ст.345 ч.3\tСТРОЙКОНТОР\t14
ст.345 ч.3\t№27\t11
ст.345 ч.3\tАҒИДОЛЛА НҰҒЫМАНОВ\t2
ст.345 ч.3\tГРУШЕВАЯ\t28
ст.345 ч.3\tАЛМАГҮЛ\t5
ст.345 ч.3\t№13\t30
ст.345 ч.3\tОРЫНГАЛИ СМАГУЛОВ\t33
ст.345 ч.3\tБЕРЕКЕ\t14
ст.188 ч.2\tХИМИК АТЫРАУ\t
ст.345 ч.3\tИСАТАЙ\t8
ст.296 ч.2\tОРЫНГАЛИ СМАГУЛОВ\t5
ст.345 ч.3\t№ 7\t5
ст.188 ч.2\tЮРИЙ ГАГАРИН\t12
ст.188 ч.2\t16\t4
ст.345 ч.3\tАЛМАГҮЛ\t8
ст.296 ч.2\tОРЫНГАЛИ СМАГУЛОВ\t5
ст.188 ч.2\t16\t4
ст.345 ч.3\t№2\t46
ст.188 ч.2\tГРУШЕВАЯ\t121
ст.188 ч.2\t10\t21
ст.345 ч.3\t№5\t46
ст.345 ч.3\tАВАНГАРД-3\t
ст.345 ч.3\tАВАНГАРД-3\t
ст.345 ч.3\tОРЫНГАЛИ СМАГУЛОВ\t33`;

// ═══════════════════════════════════════════════════
const logEl = document.getElementById("log");
const progressFill = document.getElementById("progressFill");
const statsEl = document.getElementById("stats");

function log(msg, cls) {
    const span = document.createElement("span");
    if (cls) span.className = cls;
    span.textContent = msg + "\n";
    logEl.appendChild(span);
    logEl.scrollTop = logEl.scrollHeight;
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

let streetCoords = {};
let crimePointsJS = "";

async function dgisGeocode(query, apiKey) {
    const url = `https://catalog.api.2gis.com/3.0/items/geocode?q=${encodeURIComponent(query)}&fields=items.point&key=${apiKey}`;
    const resp = await fetch(url);
    if (resp.status !== 200) throw new Error("HTTP " + resp.status);
    const data = await resp.json();
    if (data.result && data.result.items && data.result.items.length > 0) {
        const item = data.result.items[0];
        if (item.point) return { lat: item.point.lat, lng: item.point.lon };
    }
    return null;
}

function isInAtyrau(c) {
    return c.lat >= 46.9 && c.lat <= 47.3 && c.lng >= 51.7 && c.lng <= 52.2;
}

async function startGeocoding() {
    const apiKey = document.getElementById("apiKey").value.trim();
    if (!apiKey) { alert("Введите API ключ 2GIS"); return; }

    document.getElementById("startBtn").disabled = true;
    document.getElementById("downloadBtn").style.display = "none";
    logEl.innerHTML = "";
    streetCoords = {};

    // Test API key
    log("Проверяю API ключ...", "info");
    try {
        const test = await dgisGeocode("Атырау", apiKey);
        if (test) {
            log("API ключ работает!", "ok");
        } else {
            log("API ключ может быть невалидным. Продолжаю...", "fail");
        }
    } catch (err) {
        log("Ошибка API: " + err.message, "fail");
        document.getElementById("startBtn").disabled = false;
        return;
    }

    const total = NAMED_STREETS.length + MICRODISTRICTS.length;
    let done = 0, found = 0, notFound = 0;

    // Geocode named streets
    log("\n=== Геокодирование улиц (" + NAMED_STREETS.length + ") ===", "info");
    for (const street of NAMED_STREETS) {
        const variants = [
            `Атырау, ${street}`,
            `${street}, Атырау`,
            `Атырау, улица ${street}`,
        ];
        let result = null;
        for (const q of variants) {
            try {
                result = await dgisGeocode(q, apiKey);
                if (result && isInAtyrau(result)) break;
                result = null;
            } catch (err) {
                log("  Ошибка: " + err.message, "fail");
            }
            await sleep(150);
        }

        if (result && isInAtyrau(result)) {
            streetCoords[street] = result;
            found++;
            log(`  ✓ ${street} → ${result.lat.toFixed(6)}, ${result.lng.toFixed(6)}`, "ok");
        } else {
            notFound++;
            log(`  ✗ ${street} → не найден`, "fail");
        }
        done++;
        progressFill.style.width = (done / total * 100) + "%";
        statsEl.textContent = `${done}/${total} | Найдено: ${found} | Не найдено: ${notFound}`;
    }

    // Geocode microdistricts
    log("\n=== Геокодирование микрорайонов (" + MICRODISTRICTS.length + ") ===", "info");
    for (const num of MICRODISTRICTS) {
        const variants = [
            `Атырау, ${num} микрорайон`,
            `${num} микрорайон, Атырау`,
        ];
        let result = null;
        for (const q of variants) {
            try {
                result = await dgisGeocode(q, apiKey);
                if (result && isInAtyrau(result)) break;
                result = null;
            } catch (err) {}
            await sleep(150);
        }

        if (result && isInAtyrau(result)) {
            streetCoords["MICRO_" + num] = result;
            found++;
            log(`  ✓ Микрорайон ${num} → ${result.lat.toFixed(6)}, ${result.lng.toFixed(6)}`, "ok");
        } else {
            notFound++;
            log(`  ✗ Микрорайон ${num} → не найден`, "fail");
        }
        done++;
        progressFill.style.width = (done / total * 100) + "%";
        statsEl.textContent = `${done}/${total} | Найдено: ${found} | Не найдено: ${notFound}`;
    }

    log(`\n=== Итого: ${found} найдено, ${notFound} не найдено ===`, "info");

    // Generate crime-points.js
    log("\nГенерирую crime-points.js...", "info");
    crimePointsJS = generateCrimePoints();
    log("Готово! Нажмите кнопку для скачивания.", "ok");

    document.getElementById("downloadBtn").style.display = "inline-block";
    document.getElementById("startBtn").disabled = false;
}

function generateCrimePoints() {
    const CENTER = { lat: 47.1067, lng: 51.9203 };

    function isMicro(name) { return /^(№\s*)?\d+$/.test(name); }
    function getMicroNum(name) { const m = name.match(/(\d+)/); return m ? m[1] : null; }
    function jitter() { return (Math.random() - 0.5) * 0.0006; }
    function houseOffset(house) {
        if (!house) return { dlat: 0, dlng: 0 };
        const num = parseInt(house.replace(/[^\d]/g, ""), 10);
        if (isNaN(num)) return { dlat: 0, dlng: 0 };
        const t = (num % 200) / 200;
        return { dlat: (t - 0.5) * 0.002, dlng: (t - 0.5) * 0.001 };
    }

    // Aliases
    const aliases = {
        "АБАЙ ҚҰНАНБАЕВ": "АБАЙ",
        "АЗАТТЫК": "АЗАТТЫҚ",
        "АВАНГАРД -2": "АВАНГАРД-2",
        "АТЫРАУ ДОССОР": "АТЫРАУ-ДОССОР",
        "ОРКЕН": "ӨРКЕН",
        "С.БЕЙБАРЫС": "БЕЙБАРЫС",
        "АЛМАГҮЛ МӨЛТЕК АУДАНЫ": "АЛМАГҮЛ",
        "ИБАТОЛЛА ШЕКЕНОВ": "ИБАТОЛЛА ШЕКЕНОВ",
    };

    const lines = CRIME_RAW.split("\n").filter(l => l.trim());
    const points = [];
    let id = 5000;

    for (const line of lines) {
        const parts = line.split("\t");
        const article = (parts[0] || "").trim();
        const street = (parts[1] || "").trim();
        const house = (parts[2] || "").trim();
        if (!article || !street) continue;

        let lat, lng;
        const key = street.toUpperCase();
        const ho = houseOffset(house);

        if (isMicro(street)) {
            const num = getMicroNum(street);
            const c = streetCoords["MICRO_" + num];
            lat = (c ? c.lat : CENTER.lat) + ho.dlat + jitter();
            lng = (c ? c.lng : CENTER.lng) + ho.dlng + jitter();
        } else {
            const resolvedKey = aliases[key] || key;
            const c = streetCoords[resolvedKey] || streetCoords[key];
            if (c) {
                lat = c.lat + ho.dlat + jitter();
                lng = c.lng + ho.dlng + jitter();
            } else {
                lat = CENTER.lat + (Math.random() - 0.5) * 0.012;
                lng = CENTER.lng + (Math.random() - 0.5) * 0.012;
            }
        }

        const address = house ? street + " " + house : street;
        points.push({
            id: id++,
            lat: Math.round(lat * 100000) / 100000,
            lng: Math.round(lng * 100000) / 100000,
            category: "crime",
            title_ru: address, title_kz: address,
            address_ru: address, address_kz: address,
            description_ru: article + " — " + address,
            description_kz: article + " — " + address,
            photos: []
        });
    }

    return `/**\n * Auto-generated crime points data (2GIS geocoded)\n * ${points.length} crime records from prosecutor's office\n */\nvar CRIME_POINTS = ${JSON.stringify(points, null, 2)};\n`;
}

function downloadResult() {
    const blob = new Blob([crimePointsJS], { type: "text/javascript" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "crime-points.js";
    a.click();

    // Also offer streets-coords.json
    setTimeout(() => {
        const blob2 = new Blob([JSON.stringify(streetCoords, null, 2)], { type: "application/json" });
        const a2 = document.createElement("a");
        a2.href = URL.createObjectURL(blob2);
        a2.download = "streets-coords.json";
        a2.click();
    }, 500);
}
</script>
</body>
</html>
